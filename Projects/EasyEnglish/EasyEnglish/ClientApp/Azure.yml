pool:
  name: Azure Pipelines
  demands: yarn

steps:
- task: NodeTool@0
  displayName: 'Use Node 19.x'
  inputs:
    versionSpec: 19.x

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@3
  displayName: 'Yarn install'
  inputs:
    projectDirectory: GCHProject/GCHWeb/GCHWeb/ClientApp

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@3
  displayName: 'Yarn build'
  inputs:
    projectDirectory: GCHProject/GCHWeb/GCHWeb/ClientApp
    arguments: 'run build'

- script: 'mv GCHProject/GCHWeb/GCHWeb/ClientApp/build GCHProject/GCHWeb/GCHWeb/ClientApp/wwwroot'
  displayName: 'Command Line Script'

- task: DotNetCoreCLI@2
  displayName: 'dotnet restore'
  inputs:
    command: restore
    projects: GCHProject/GCHWeb/GCHWeb/GCHWeb.csproj

- task: DotNetCoreCLI@2
  displayName: 'dotnet build'
  inputs:
    projects: GCHProject/GCHWeb/GCHWeb/GCHWeb.csproj

- task: DotNetCoreCLI@2
  displayName: 'dotnet publish'
  inputs:
    command: publish
    arguments: '-c Release -o $(Build.ArtifactStagingDirectory)/publish'

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: GCH'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/publish'
    ArtifactName: 'GCH-backend'
